---
icon: ri:database-2-line
---

# Storage Layer

Nitro provides a built-in storage layer that can abstract filesystem or database or any other data source.

`useStorage()` is an instance of [createStorage](https://unstorage.unjs.io/getting-started/usage) using the [memory driver](https://unstorage.unjs.io/drivers/memory).

By default, Nitro will also mount the current directory using the filesystem driver, using a prefix and where each folder serve to extend the prefix.

- Every file will be under the `root` base.
- Every source file will be under the `src` base. (By default, `src` is the `root` base)

## Usage

To use the storage layer, you can use the `useStorage()` and call `getItem` to retrieve an item and `setItem` to set an item.

```ts
await useStorage().setItem('test:foo', { hello: 'world' })
await useStorage().getItem('test:foo')

// You can also specify the base in useStorage(base)
await useStorage('test').setItem('foo', { hello: 'world' })
// `useStorage` and chained functions support a generic type to infer the return type
await useStorage<{ hello: string }>('test').getItem('foo')
await useStorage('test').getItem<{ hello: string }>('foo')
```

See [Unstorage](https://unstorage.unjs.io/getting-started/usage) for detailed usage.

## Mount Points

You can mount storage drivers using the `storage` option in the [Nitro config](/guide/config) file.

The key is the mount point name, and the value is the driver name and configuration. You can find the driver list on [unstorage documentation](https://unstorage.unjs.io/) with their configuration. You can mount multiple drivers.

::code-group
```ts [nitro.config.ts]
export default defineNitroConfig({
  storage: {
    'redis': {
      driver: 'redis',
      /* redis connector options */
    },
    'db': {
      driver: 'fs',
      base: './data/db'
    }
  }
})
```
```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    storage: {
      redis: {
        driver: 'redis',
        /* redis connector options */
      },
      db: {
        driver: 'fs',
        base: './.data/db'
      }
    }
  }
})
```
::

::alert{type="warning"}
`cache` is a reserved mount point for the [cache layer](/guide/cache). Do not use it unless you want to overwrite the cache layer.
::

### Runtime configuration

In scenarios where the mount point configuration is not known until runtime, Nitro can dynamically add mount points during startup using [plugins](/guide/plugins).

::code-group
```ts [plugins/storage.ts]
import redisDriver from 'unstorage/drivers/redis'

export default defineNitroPlugin(() => {
  const storage = useStorage()

  // Dynamically pass in credentials from runtime configuration, or other sources
  const driver = redisDriver({
      base: 'redis',
      host: useRuntimeConfig().redis.host,
      port: useRuntimeConfig().redis.port,
      /* other redis connector options */
    })

  // Mount driver
  storage.mount('redis', driver)
})
```
``` ts [nitro.config.ts]
export default defineNitroConfig({
  runtimeConfig: {
    redis: { // Default values
      host: '',
      port: 0,
      /* other redis connector options */
    }
  }
})
```
``` ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    redis: { // Default values
      host: '',
      port: 0,
      /* other redis connector options */
    }
  }
})
```
::

::alert{type="warning"}
This is a temporary workaround, with a better solution coming in the future! Keep a lookout on the GitHub issue [here](https://github.com/unjs/nitro/issues/1161#issuecomment-1511444675).
::

## Development only Storage

You can use the `devStorage` key to overwrite the storage configuration during development. This is very useful when you use a database in production and want to use the filesystem in development.

In order to use the `devStorage` key, you need to use the `nitro dev` command and the key in the `storage` option must be the same as the production one.

::code-group
```ts [nitro.config.ts]
export default defineNitroConfig({
  // Production
  storage: {
    db: {
      driver: 'redis',
      /* redis connector options */
    }
  },
  // Development
  devStorage: {
    db: {
      driver: 'fs',
      base: './data/db'
    }
  }
})
```
```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    // Production
    storage: {
      db: {
        driver: 'redis',
        /* redis connector options */
      }
    },
    // Development
    devStorage: {
      db: {
        driver: 'fs',
        base: './data/db'
      }
    }
  }
})
```
::

You will also be able to access to a `build` namespace in the storage layer only during development. It contains file generated by Nitro.
